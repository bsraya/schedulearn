{% extends "index.html" %}

{% block content %}
{% if user %}
{% include "components/navbar.html" %}
<div class="container">
  {% if user.role_mask | determine_role in ['admin', 'superadmin'] %}
  <div class="block">
    <div class="columns">
      <div class="column is-one-fourth card" style="display: flex;">
        <div>
          <p>Total Users</p>
          <p class="title is-3">{{ users | length }}</p>
        </div>
        <i class="fas fa-users fa-2xl" style="margin: auto 0 auto auto;"></i>
      </div>
      <div class="column is-0"></div>
      <div class="column is-one-fourth card"  style="display: flex;">
        <div>
          <p>Total Jobs</p>
          <p class="title is-3">{{ jobs | length }}</p>
        </div>
        <i class="fas fa-tasks fa-2xl" style="margin: auto 0 auto auto;"></i>
      </div>
      <div class="column is-0"></div>
      <div class="column is-one-fourth card"  style="display: flex;">
        <div>
          <p>Total Servers</p>
          <p class="title is-3">{{ no_of_servers }}</p>
        </div>
        <i class="fas fa-server fa-2xl" style="margin: auto 0 auto auto;"></i>
      </div>
      <div class="column is-0"></div>
      <div class="column is-one-fourth card"  style="display: flex;">
        <div>
          <p>Total GPUs</p>
          <p class="title is-3">{{ no_of_gpus }}</p>
        </div>
        <i class="fas fa-microchip fa-2xl" style="margin: auto 0 auto auto;"></i>
      </div>
    </div>
  </div>
  {% endif %}

  <div class="block">
    <div class="columns is-multiline">
      <div class="column card auto">
        <h1 class="title is-4">Server Analytics</h1>
      </div>
      <div class="column is-0"></div>
      <div class="column card auto">
        <h1 class="title is-4">GPU Utilization</h1>
      </div>
    </div>
  </div>

  <div class="columns block" >
    <div class="column auto card">
      <h1 class="title is-4 block">Recent Jobs</h1>
        {% with jobs = jobs %}
          {% include "components/job_table.html" %}
        {% endwith %}
    </div>
  </div>
</div>
{% else %}
<h1 style="font-size: 3rem;">
  You are not authorized. Please sign in.
  <a href="/signin">Sign in</a>
</h1>
{% endif %}
<style>
  .dashboard-tiles {
    display: block;
    flex-direction: row;
    align-items: center;
    margin-top: 20px;
  }
</style>

<script>
  const ctx = document.getElementById('myChart');
  const ctx2 = document.getElementById('myChart2');

  new Chart(ctx, {
    type: 'bar',
    data: {
      labels: ['Red', 'Blue', 'Yellow', 'Green', 'Purple', 'Orange'],
      datasets: [{
        label: '# of Votes',
        data: [12, 19, 3, 5, 2, 3],
        borderWidth: 1
      }]
    },
    options: {
      scales: {
        y: {
          beginAtZero: true
        }
      }
    }
  });

  new Chart(ctx2, {
    type: 'bar',
    data: {
      labels: ['Red', 'Blue', 'Yellow', 'Green', 'Purple', 'Orange'],
      datasets: [{
        label: '# of Votes',
        data: [12, 19, 3, 5, 2, 3],
        borderWidth: 1
      }]
    },
    options: {
      scales: {
        y: {
          beginAtZero: true
        }
      }
    }
  });
</script>
{% endblock %}